/**MediaMatcher.js
 * Project-Page: https://github.com/andreasBritten/MediaMatcher.js
 * @version 1.4*/
var mediaMatcherObjectCount=0;function MediaMatcher(a){this.queryObjects=[];this.nativeQuerySupport=false;this.preLoadingCss=false;this.matcher=a;this.loadDynamicCss=true;this.loadDynamicObj=true;this.loadDynamicJS=true;this.initialLoad=true;this.waitingTime=0;this.showInformation=false;this.infoBox=null;this.timer=null;this.loadingInterval=null;this.lazyCssLoad=false;this.lazyCssLoadMaxTime=20000;this.info="";this.device="desktop";this.id="matcher"+mediaMatcherObjectCount;mediaMatcherObjectCount+=1}MediaMatcher.prototype={init:function(){var f=0;this.device=this.getDeviceCookie()||this.detectDevice();this.nativeQuerySupport=window.matchMedia&&this.nativeQuerySupport?true:false;for(var e in this.matcher){this.queryObjects.push({isMatching:false,isCssInDom:false,isCssLoaded:false,isJsInDom:false,isJsLoaded:false,isLoaded:false,isLoading:false,isUnloading:false,id:"query"+f,styleLoadedInterval:null,styleLoadedIntervalTime:0,jsLoadedCnt:0,device:e.match(/(::)(.*)(::).*/)&&RegExp.$2||"all",queryString:e.match(/(::.*::\s*)?(.*)/)&&RegExp.$2||"screen",media:e.match(/(only\s+)?([a-zA-Z]+)(\sand)?[\s]*[\(]/)&&RegExp.$2||"screen",minWidth:e.match(/\(min\-width:[\s]*([\s]*[0-9]+)px[\s]*\)/)&&parseFloat(RegExp.$1)||0,maxWidth:e.match(/\(max\-width:[\s]*([\s]*[0-9]+)px[\s]*\)/)&&parseFloat(RegExp.$1)||Number.MAX_VALUE,js:this.matcher[e]["js"]||[],obj:this.matcher[e]["obj"]||[],css:this.matcher[e]["css"]||[],ref:[]});f+=1}if(this.preLoadingCss){for(var c in this.queryObjects){var a=this.queryObjects[c];for(var d in a.css){this.ajaxCall(a.css[d],function(g){})}}}if(this.nativeQuerySupport&&this.loadDynamicCss){for(var c in this.queryObjects){var a=this.queryObjects[c];this.loadStyles(true,a,function(){})}}if(this.loadDynamicCss||this.loadDynamicObj||this.loadDynamicJS){var b=this.getResizeCallback();if(window.addEventListener){window.addEventListener("resize",b,false)}else{if(window.attachEvent){window.attachEvent("onresize",b)}}}this.updateMedia()},updateMedia:function(){var e=this;if(this.timer!=null){window.clearTimeout(this.timer);this.timer=null}var a=[];var d=[];var i=[];var h=[];for(var f in this.queryObjects){var g=this.queryObjects[f];g.isMatching=this.matchingDevice(g)&&this.matchingMedia(g);if(g.isMatching&&g.isUnloading){h.push(g)}if(!g.isMatching&&g.isLoading){i.push(g)}}for(var f in i){var g=i[f];this.clearStyleLoadedTimer(g);this.unloadStyles(g);g.isLoading=false;g.isLoaded=false}for(var f in h){var g=h[f];g.isUnloading=false}for(var f in this.queryObjects){var g=this.queryObjects[f];if(g.isMatching&&!g.isLoaded){a.push(g)}if(!g.isMatching&&g.isLoaded){d.push(g)}}var b=a.length>0;var c=d.length>0;for(var f in d){var g=d[f];if(this.loadDynamicObj){this.unloadObjects(g)}if(this.loadDynamicJS){this.unloadJS(g)}if(this.loadDynamicCss&&!b){this.unloadStyles(g);g.isUnloading=false}else{if(this.loadDynamicCss){g.isUnloading=true}}g.isLoaded=false}for(var f in a){var g=a[f];g.isLoading=true;(function(j){e.loadStyles(j,g,function(){var o=[];var n=[];for(var m in e.queryObjects){var l=e.queryObjects[m];if(!l.isMatching&&l.isUnloading){n.push(l)}if(l.isMatching&&l.isLoading){o.push(l)}}var k=true;for(var m in o){var l=o[m];if(!l.isCssLoaded){k=false;break}}if(k){for(var m in n){if(e.loadDynamicCss){var l=n[m];e.unloadStyles(l);l.isUnloading=false}}for(var m in o){var l=o[m];e.loadJS(j,l,function(){if(j||e.loadDynamicObj){e.loadObjects(l,0)}l.isLoading=false})}}})})(this.initialLoad);g.isLoaded=true}this.initialLoad=false;this.printInfo()},matchingMedia:function(b){if(window.matchMedia){return window.matchMedia(b.queryString).matches}else{var a=this.getCurrentWindowWidth();return(a>=b.minWidth&&a<=b.maxWidth)}},getCurrentWindowWidth:function(){var b=window.document.documentElement.clientWidth;var a=window.document.body!=null&&window.document.body.clientWidth;var c=window.document.compatMode==="CSS1Compat";return c&&b||a||b},matchingDevice:function(a){return(a.device=="all"||this.device==a.device)},getResizeCallback:function(){var a=this;var b=function(){};if(this.waitingTime<=0){b=function(){a.updateMedia()}}else{b=function(){if(a.timer!=null){window.clearTimeout(a.timer)}a.timer=window.setTimeout(function(){a.updateMedia()},a.waitingTime)}}return b},clearStyleLoadedTimer:function(a){if(a.styleLoadedInterval!=null){window.clearInterval(a.styleLoadedInterval);a.styleLoadedInterval=null}a.styleLoadedIntervalTime=0},styleLoaded:function(e,a,d){var b=this;var c=25;this.clearStyleLoadedTimer(e);e.styleLoadedInterval=window.setInterval(function(){var f=[];for(var j in a){f[j]=false;try{if(a[j].sheet&&a[j].sheet.cssRules.length>0){f[j]=true}else{if(a[j].styleSheet&&a[j].styleSheet.cssText.length>0){f[j]=true}else{if(a[j].innerHTML&&a[j].innerHTML.length>0){f[j]=true}}}}catch(h){}}var g=true;for(var j in f){if(f[j]==false){g=false;break}}if(g===true||e.styleLoadedIntervalTime>=b.lazyCssLoadMaxTime){b.clearStyleLoadedTimer(e);if(e.isMatching){d()}}e.styleLoadedIntervalTime+=c},c)},loadStyles:function(b,h,g){var f=document.getElementsByTagName("head")[0];if(f){var c=[];if(b||this.loadDynamicCss){for(var d in h.css){if(!h.isCssInDom){var e=document.createElement("link");e.rel="stylesheet";e.type="text/css";if(this.nativeQuerySupport&&this.loadDynamicCss){e.media=h.queryString}e.id=this.id+"."+h.id+".css"+d;e.href=h.css[d];f.appendChild(e);c.push(e)}else{if(this.nativeQuerySupport){var e=document.getElementById(this.id+"."+h.id+".css"+d);c.push(e)}}}if(c.length>0){h.isCssInDom=true}}var a=function(){h.isCssLoaded=true;g()};if(this.lazyCssLoad&&c.length>0){this.styleLoaded(h,c,a)}else{a()}}},unloadStyles:function(d){if(this.nativeQuerySupport){return}var c=document.getElementsByTagName("head")[0];if(c&&d.isCssInDom){for(var b in d.css){var a=document.getElementById(this.id+"."+d.id+".css"+b);c.removeChild(a)}d.isCssInDom=false;d.isCssLoaded=false}},unloadAllStyles:function(b){for(var a in b){this.unloadStyles(b[a])}},loadJS:function(b,g,f){var e=document.getElementsByTagName("head")[0];if(e){if((b||this.loadDynamicJS)&&!g.isJsInDom&&g.js.length>0){g.jsLoadedCnt=0;var a=function(){g.jsLoadedCnt+=1;if(g.jsLoadedCnt==g.js.length){f()}};for(var d in g.js){var c=document.createElement("script");c.type="text/javascript";c.id=this.id+"."+g.id+".js"+d;c.src=g.js[d];if(c.addEventListener){c.addEventListener("load",a,false)}else{if(c.readyState){c.onreadystatechange=a}}e.appendChild(c)}g.isJsInDom=true}else{f()}}},unloadJS:function(d){var b=document.getElementsByTagName("head")[0];if(b&&d.isJsInDom){for(var a in d.js){var c=document.getElementById(this.id+"."+d.id+".js"+a);b.removeChild(c)}d.isJsInDom=false}},loadObjects:function(queryObject,index){if(index>=queryObject.obj.length){return}if(queryObject.ref[index]==undefined||queryObject.ref[index]==null){if(typeof(queryObject.obj[index])=="string"){(function(myObj,obj,i){myObj.ajaxCall(obj.obj[i],function(data){obj.ref[i]=eval("("+data+")");obj.ref[i].onInit();obj.ref[i].onMatch();myObj.loadObjects(obj,i+1)})})(this,queryObject,index)}else{queryObject.ref[index]=queryObject.obj[index];queryObject.ref[index].onInit();queryObject.ref[index].onMatch();this.loadObjects(queryObject,index+1)}}else{queryObject.ref[index].onMatch();this.loadObjects(queryObject,index+1)}},unloadObjects:function(c){for(var a in c.ref){try{c.ref[a].onUnmatch()}catch(b){}}},detectDevice:function(){var a=navigator.userAgent.toLowerCase();if(Boolean(a.match(/iphone/)||a.match(/ipod/)||a.match(/ipad/)||a.match(/blackberry/)||a.match(/playbook/)||a.match(/android/)||a.match(/(windows phone os|windows ce|windows mobile)/)||a.match(/mobile/)||a.match(/(gt-p1000|sgh-t849|shw-m180s)/)||a.match(/tablet pc/)||a.match(/tablet/)||a.match(/(palmos|palmsource| pre\/)/)||a.match(/kindle/)||a.match(/(opera mini|iemobile|sonyericsson|smartphone)/))){return"mobile"}if(Boolean(a.match(/hbbtv/)||a.match(/nettv/)||a.match(/ce\-html/)||a.match(/cehtml/)||a.match(/large screen/)||a.match(/googletv/)||a.match(/large/))){return"tv"}return"desktop"},ajaxCall:function(a,d){var b=null;try{b=new XMLHttpRequest()}catch(c){}if(b==null){try{b=new ActiveXObject("Microsoft.XMLHTTP")}catch(c){}}if(b==null){try{b=new ActiveXObject("Msxml2.XMLHTTP")}catch(c){}}if(b){b.open("GET",a,true);b.onreadystatechange=function(){if(b.readyState==4){d(b.responseText)}};b.send(null)}},createInfoBox:function(){if(this.infoBox===null){this.infoBox=document.createElement("div");this.infoBox.style.position="fixed";this.infoBox.style.bottom="0px";this.infoBox.style.left="0px";this.infoBox.style.width="100%";this.infoBox.style.fontSize="11px";this.infoBox.style.fontFamily="monospace";this.infoBox.style.backgroundColor="#000";this.infoBox.style.color="#fff";this.infoBox.style.zIndex="99999"}},handleInfoBox:function(){this.createInfoBox();var a=document.getElementsByTagName("body")[0];if(a){if(this.showInformation){a.appendChild(this.infoBox)}}},printInfo:function(){if(this.showInformation===true){this.handleInfoBox();var c="== MediaMatcher Information ==";c+="<br/>- windowWidth: "+this.getCurrentWindowWidth()+"px";c+="<br/>- currentlyMatching: ";var d=true;for(var b in this.queryObjects){var a=this.queryObjects[b];if(a.isMatching){var e=d?"":" | ";c+='"'+a.queryString+'"'+e;d=false}}c+="<br/>- detectedDevice: "+this.device;c+="<br/>- userAgent: "+navigator.userAgent.toLowerCase();this.infoBox.innerHTML=c}},showInfo:function(a){this.showInformation=a;this.handleInfoBox()},setDeviceCookie:function(c){var a=new Date();var b=a.getTime()+(c*60*60*1000);a.setTime(b);document.cookie="MediaMatcherDevice="+this.device+"; expires="+a.toGMTString()},getDeviceCookie:function(){return document.cookie.match(/MediaMatcherDevice=([a-z]*)[;\s]*/)&&RegExp.$1||false},dynamicLoadCss:function(a){this.loadDynamicCss=a},dynamicLoadJS:function(a){this.loadDynamicJS=a},dynamicTriggerObj:function(a){this.loadDynamicObj=a},waitBeforeDynamicLoad:function(a){this.waitingTime=a},waitForCssIsLoaded:function(a,b){this.lazyCssLoad=a;this.lazyCssLoadMaxTime=b},tryToSupportNativeMediaQueries:function(a){this.nativeQuerySupport=a},preLoadCss:function(a){this.preLoadingCss=a},forceDevice:function(a,b){if(a=="auto"){a=this.detectDevice();b=0}this.device=a;this.setDeviceCookie(b);this.updateMedia()}};